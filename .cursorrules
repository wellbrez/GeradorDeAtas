# Regras de Desenvolvimento - Sistema de Atas de Reuni√£o

## Princ√≠pios Gerais

1. **Type Safety First**: Sempre use TypeScript com tipos expl√≠citos. Evite `any`.
2. **Modularidade**: Mantenha c√≥digo modular e reutiliz√°vel. Cada feature deve ser independente.
3. **Separa√ß√£o de Responsabilidades**: Componentes para UI, Hooks para l√≥gica de estado, Services para l√≥gica de neg√≥cio.
4. **Documenta√ß√£o**: Adicione coment√°rios JSDoc para fun√ß√µes p√∫blicas e componentes principais.

## Estrutura de Arquivos

### Componentes
- Use PascalCase para nomes de componentes (`MeetingMinutesList.tsx`)
- Um componente por arquivo
- Exporte o componente como default
- Coloque types/interfaces no mesmo arquivo ou em `types.ts` da feature

### Hooks
- Prefixo `use` obrigat√≥rio (`useMeetingMinutes.ts`)
- Um hook por arquivo
- Documente par√¢metros e retorno com JSDoc

### Services
- Use camelCase (`storageService.ts`)
- Fun√ß√µes puras quando poss√≠vel
- Tratamento de erros expl√≠cito

### Types
- Interfaces para objetos (`interface MeetingMinutes`)
- Types para unions/intersections (`type Status = 'Pendente' | 'Conclu√≠do'`)
- Coloque types compartilhados em `/types`

## Conven√ß√µes de C√≥digo

### TypeScript
```typescript
// ‚úÖ BOM
interface Participant {
  nome: string;
  email: string;
}

function addParticipant(participant: Participant): void {
  // ...
}

// ‚ùå RUIM
function addParticipant(participant: any) {
  // ...
}
```

### React Components
```typescript
// ‚úÖ BOM
interface ParticipantListProps {
  participants: Participant[];
  onRemove: (id: string) => void;
}

export default function ParticipantList({ 
  participants, 
  onRemove 
}: ParticipantListProps) {
  return (
    // JSX
  );
}

// ‚ùå RUIM
export default function ParticipantList(props: any) {
  // ...
}
```

### Hooks
```typescript
// ‚úÖ BOM
/**
 * Hook para gerenciar lista de participantes
 * @param initialParticipants - Lista inicial de participantes
 * @returns Objeto com participantes e fun√ß√µes de manipula√ß√£o
 */
export function useParticipants(initialParticipants: Participant[] = []) {
  const [participants, setParticipants] = useState<Participant[]>(initialParticipants);
  
  const addParticipant = useCallback((participant: Participant) => {
    setParticipants(prev => [...prev, participant]);
  }, []);
  
  return { participants, addParticipant };
}
```

## Naming Conventions

- **Vari√°veis/Fun√ß√µes**: camelCase (`getMeetingMinutes`)
- **Constantes**: UPPER_SNAKE_CASE (`MAX_ITEMS_PER_PAGE`)
- **Componentes**: PascalCase (`MeetingMinutesList`)
- **Types/Interfaces**: PascalCase (`MeetingMinutes`)
- **Arquivos de componente**: PascalCase (`MeetingMinutesList.tsx`)
- **Arquivos de utilit√°rios**: kebab-case (`format-date.ts`)

## Estrutura de Pastas

```
src/
‚îú‚îÄ‚îÄ components/          # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ ui/             # Componentes b√°sicos
‚îÇ   ‚îî‚îÄ‚îÄ layout/          # Layout components
‚îú‚îÄ‚îÄ features/           # Features organizadas
‚îÇ   ‚îú‚îÄ‚îÄ atas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.ts
‚îÇ   ‚îú‚îÄ‚îÄ participantes/
‚îÇ   ‚îî‚îÄ‚îÄ itens/
‚îú‚îÄ‚îÄ services/           # Servi√ßos compartilhados
‚îú‚îÄ‚îÄ hooks/              # Custom hooks compartilhados
‚îú‚îÄ‚îÄ utils/              # Fun√ß√µes utilit√°rias
‚îú‚îÄ‚îÄ types/              # Types globais
‚îî‚îÄ‚îÄ styles/             # Estilos globais
```

## Regras Espec√≠ficas do Projeto

### Armazenamento Local
- Use o servi√ßo `storageService` para todas as opera√ß√µes de localStorage
- Sempre trate erros de localStorage (quota excedida, etc)
- Valide dados ao recuperar do localStorage

### Gera√ß√£o de HTML
- Separe a l√≥gica de gera√ß√£o de HTML em servi√ßo dedicado
- Use templates/strings para constru√ß√£o de HTML
- Mantenha estilos inline ou em se√ß√£o `<style>` no HTML gerado
- Implemente pagina√ß√£o autom√°tica baseada em altura estimada

### Hierarquia de Itens
- Numera√ß√£o autom√°tica: "1", "1.1", "1.1.1"
- Valide hierarquia ao criar/editar itens
- Mantenha refer√™ncias pai/filho consistentes

### Rastreabilidade
- Todas as a√ß√µes devem gerar entrada no hist√≥rico
- Inclua timestamp, respons√°vel e descri√ß√£o
- Mantenha hist√≥rico imut√°vel (n√£o edite, apenas adicione)

### Exporta√ß√£o
- HTML deve ser auto-contido (sem depend√™ncias externas)
- Inclua filtros interativos no HTML gerado
- Suporte a impress√£o (CSS @media print)

## Testes (quando implementados)

- Teste fun√ß√µes utilit√°rias
- Teste hooks com `@testing-library/react-hooks`
- Teste componentes com `@testing-library/react`
- Cobertura m√≠nima: 70% para servi√ßos cr√≠ticos

## Performance

- Use `React.memo` para componentes pesados
- Use `useMemo` e `useCallback` quando apropriado
- Lazy load de componentes grandes
- Debounce em inputs de busca/filtro

## Acessibilidade

- Use elementos sem√¢nticos HTML
- Adicione `aria-label` em bot√µes sem texto
- Suporte navega√ß√£o por teclado
- Contraste adequado de cores

## Tratamento de Erros

- Sempre trate erros de forma expl√≠cita
- Use try/catch em opera√ß√µes ass√≠ncronas
- Forne√ßa feedback ao usu√°rio em caso de erro
- Log erros para debug (console.error em dev)

## Coment√°rios e Documenta√ß√£o

- JSDoc para fun√ß√µes p√∫blicas
- Coment√°rios explicativos para l√≥gica complexa
- README.md em cada feature principal
- Documente decis√µes arquiteturais importantes

## Git

- Commits descritivos e at√¥micos
- Branch por feature (`feature/nome-da-feature`)
- PRs com descri√ß√£o clara das mudan√ßas
- N√£o commite arquivos gerados ou depend√™ncias

## Depend√™ncias

- Prefira bibliotecas leves e bem mantidas
- Evite depend√™ncias desnecess√°rias
- Mantenha depend√™ncias atualizadas (security patches)
- Documente depend√™ncias cr√≠ticas no README

## Estilos

- Use CSS Modules para estilos scoped
- CSS Variables para temas
- Mobile-first quando aplic√°vel
- Consist√™ncia visual com design system b√°sico

## Valida√ß√£o

- Valide inputs do usu√°rio
- Valide dados ao recuperar do storage
- Mensagens de erro claras e √∫teis
- Valida√ß√£o tanto no cliente quanto na l√≥gica de neg√≥cio

---

## Li√ß√µes aprendidas ‚Äì UX e opera√ß√£o fluida

Use estas diretrizes para manter a ferramenta f√°cil de operar e consistente com as decis√µes j√° tomadas.

### Formul√°rio e edi√ß√£o

- **Formul√°rio de ata em p√°gina cheia** (n√£o modal): ocupa toda a tela para melhor uso do espa√ßo; header com "Voltar", etapas e a√ß√µes (Cancelar / Avan√ßar / Salvar).
- **Edi√ß√£o de item inline**: formul√°rio de edi√ß√£o do item aparece **logo abaixo** do item, em layout **horizontal** (descri√ß√£o, respons√°vel, data, status, a√ß√µes), para que outros itens continuem vis√≠veis enquanto um √© editado.
- **Descri√ß√£o**: campo maior, multi-linha, com **rich text** (negrito, it√°lico, sublinhado e cores da paleta Vale); exibir conte√∫do com HTML **sanitizado** (`sanitizeHtml`); armazenar HTML no hist√≥rico.

### Hist√≥rico de itens

- **Cria√ß√£o**: novo item tem **um √∫nico** registro de hist√≥rico (vazio); a primeira edi√ß√£o **substitui** esse registro em vez de acrescentar outro.
- **Por linha de hist√≥rico**: bot√£o para **editar data de cria√ß√£o** (üìÖ) e bot√£o **excluir** (‚úï) ao lado do texto; **sempre** usar confirma√ß√£o (`window.confirm`) antes de excluir hist√≥rico.
- **Exclus√£o de hist√≥rico**: permitida apenas no **mesmo dia** ou **dia seguinte** √† data de cria√ß√£o (`criadoEm`) do registro; e apenas se o item tiver **mais de um** hist√≥rico.

### Arquivamento

- Ao **copiar** uma ata, a ata **original** √© marcada como **arquivada** (`setAtaArquivada`); a nova ata √© criada normalmente.
- Na lista: atas arquivadas exibem badge **"Arquivada"** e **n√£o** mostram bot√£o Editar (somente Copiar/Excluir conforme regras gerais).

### Bot√µes e a√ß√µes (economia de espa√ßo e clareza)

- **A√ß√µes de item**: preferir **√≠cones com tooltip** (Editar ‚úèÔ∏è, Adicionar subitem ‚ûï, Excluir üóëÔ∏è) em vez de texto longo.
- **Expandir/recolher subitens**: bot√£o **√† esquerda** do item (estilo Excel), **apenas √≠cone** (‚ñ∂/‚ñº), sem texto; c√©lula fixa para alinhamento (vazio quando item n√£o tem filhos).
- **Recuo por n√≠vel**: usar **~10px por n√≠vel** de hierarquia para n√£o consumir espa√ßo em itens profundos (ex.: 1.1.1.1.1.1).

### Respons√°vel do item

- **Seletor √∫nico**: dropdown **pesquis√°vel** com os **integrantes da ata** (participantes da etapa 1); op√ß√£o **"Adicionar novo integrante √† ata"** que adiciona o participante e j√° o seleciona como respons√°vel. Componente dedicado (`ResponsavelSelect`).

### Status

- **Sele√ß√£o**: **chips coloridos** (um por status) em vez de `<select>`, usando **paleta Vale**; chip selecionado = fundo preenchido, n√£o selecionado = borda + texto na cor.
- **Badges na lista**: mesma paleta Vale por status (Pendente, Em Andamento, Conclu√≠do, Cancelado, Info), com fundo claro e borda.

### Hierarquia visual (estilo Primavera P6 / Vale)

- **Item sem filhos**: sempre **fundo branco** (em qualquer n√≠vel).
- **Item com filhos**: fundo por **n√≠vel** ‚Äì raiz (n√≠vel 1) mais marcado, n√≠veis mais profundos mais claros; tons **claros da paleta Vale** (teal/aqua), alternados; borda esquerda na cor prim√°ria.
- **Bordas**: preferir **pouco arredondamento** (ex.: 2px) para aspecto mais ‚Äús√©rio‚Äù.

### Pesquisa e filtros (etapa de itens)

- **Pesquisa no topo**: campo de busca por **n√∫mero do item** ou **texto da descri√ß√£o** (remover HTML para busca com `stripHtml`).
- **Filtro opcional**: checkbox para **ocultar** itens Conclu√≠dos, Cancelados e Info **que n√£o foram editados no dia da reuni√£o** (comparar `UltimoHistorico.criadoEm` com `cabecalho.data`).

### Expans√£o de subitens

- **Padr√£o**: subitens **expandidos por padr√£o** ao carregar (incluir todos os pais em `expandedIds` na primeira carga).
- **Ao adicionar subitem**: **expandir automaticamente** o item-pai para o novo subitem aparecer de imediato (ex.: `handleAddSubItem` que chama `onAddSubItem` e adiciona o pai a `expandedIds`).

### Exclus√£o de item

- **Visibilidade**: bot√£o Excluir **n√£o aparece** se o item **tiver filhos** (subitens).
- **Habilitado**: apenas se o item tiver **no m√°ximo um** registro de hist√≥rico; caso contr√°rio, orientar a excluir hist√≥ricos antes (tooltip quando desabilitado).
- **Confirma√ß√£o**: **sempre** exibir mensagem clara e s√©ria (ex.: "Tem certeza que deseja EXCLUIR este item? Esta a√ß√£o n√£o pode ser desfeita e excluir√° tamb√©m todos os subitens, se houver.") antes de executar a exclus√£o.

### Paleta Vale (refer√™ncia)

- Usar para status, rich text e consist√™ncia visual: Verde-Vale `#007E7A`, Aqua-Vale `#0ABB98`, Azul-Vale `#3CB5E5`, Cinza-Escuro `#555555`, Amarelo-Vale `#ECB11F`, Laranja-Vale `#EE6F16`, Cereja-Vale `#C0305E`, Preto `#000000`, Branco `#FFFFFF`.

### Refer√™ncia de comportamento

- Quando houver d√∫vida sobre fluxo ou regra de neg√≥cio, consultar **SistemaReferencia.pa.yaml** (PowerApps) para alinhar ao comportamento do app antigo, adaptando para a paleta e padr√µes acima.

---

## Li√ß√µes aprendidas ‚Äì Exporta√ß√£o HTML e filtros

### Filtros no HTML exportado

- **Data-attributes** (`data-ata-id`, `data-ata-pai`, `data-ata-desc`, `data-ata-resp`, `data-ata-date`, `data-ata-status`, `data-ata-parent`) garantem filtragem robusta e independente da estrutura DOM.
- **Itens-pai (organizadores)**: marcar com `data-ata-parent="1"`; **n√£o aplicar** filtros de Respons√°vel, Data, Status nem "Apenas Pendentes" ‚Äì esses campos n√£o se aplicam a organizadores.
- **Hierarquia**: quando um item corresponde ao filtro, exibir **todos os ancestrais** (pai, av√¥, etc.) para dar contexto; usar `data-ata-pai` para percorrer a √°rvore.
- **Parent s√≥ aparece por**: (a) filtro de descri√ß√£o/item, ou (b) ter um descendente que corresponde ao filtro.

### Impress√£o (Ctrl+P)

- **Pagina√ß√£o**: dividir conte√∫do em blocos (~35 itens por p√°gina) com `page-break-after: always`.
- **Cabe√ßalho**: repetir em cada p√°gina com "P√°gina X de N" correto.
- **Quebras**: usar `page-break-inside: avoid` em `<tr>` e blocos para n√£o quebrar no meio de itens.
- **Barra de filtros**: ocultar na impress√£o (`@media print`).

---

## Li√ß√µes aprendidas ‚Äì Links compartilh√°veis (#base64)

- **URL**: `https://.../GeradorDeAtas/#<base64-json>` ‚Äì o JSON da ata (MeetingMinutesStorage) √© codificado em base64 no hash.
- **Importa√ß√£o**: no mount do app, ler `window.location.hash`, decodificar base64, parsear JSON, validar estrutura; se v√°lido, `createMeetingMinutes(storage)` e abrir formul√°rio em edi√ß√£o; em seguida `history.replaceState` para remover o hash e evitar reimporta√ß√£o ao recarregar.
- **Codifica√ß√£o**: usar `TextEncoder` + `btoa` para UTF-8 ‚Üí base64; `atob` + `TextDecoder` para base64 ‚Üí UTF-8.
- **Bot√£o "Copiar link"**: gera URL com hash base64 e copia para clipboard; quem acessa o link importa a ata automaticamente.
- **HTML/PDF exportados**: incluem link vis√≠vel "üîó Abrir esta ata no aplicativo (modo edi√ß√£o)" no topo; ao clicar, abre o app com a ata importada; usar `appBaseUrl` passado pelo caller (`window.location.origin + window.location.pathname`) ou fallback para produ√ß√£o.
