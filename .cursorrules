# Regras de Desenvolvimento - Sistema de Atas de ReuniÃ£o

## PrincÃ­pios Gerais

1. **Type Safety First**: Sempre use TypeScript com tipos explÃ­citos. Evite `any`.
2. **Modularidade**: Mantenha cÃ³digo modular e reutilizÃ¡vel. Cada feature deve ser independente.
3. **SeparaÃ§Ã£o de Responsabilidades**: Componentes para UI, Hooks para lÃ³gica de estado, Services para lÃ³gica de negÃ³cio.
4. **DocumentaÃ§Ã£o**: Adicione comentÃ¡rios JSDoc para funÃ§Ãµes pÃºblicas e componentes principais.

## Estrutura de Arquivos

### Componentes
- Use PascalCase para nomes de componentes (`MeetingMinutesList.tsx`)
- Um componente por arquivo
- Exporte o componente como default
- Coloque types/interfaces no mesmo arquivo ou em `types.ts` da feature

### Hooks
- Prefixo `use` obrigatÃ³rio (`useMeetingMinutes.ts`)
- Um hook por arquivo
- Documente parÃ¢metros e retorno com JSDoc

### Services
- Use camelCase (`storageService.ts`)
- FunÃ§Ãµes puras quando possÃ­vel
- Tratamento de erros explÃ­cito

### Types
- Interfaces para objetos (`interface MeetingMinutes`)
- Types para unions/intersections (`type Status = 'Pendente' | 'ConcluÃ­do'`)
- Coloque types compartilhados em `/types`

## ConvenÃ§Ãµes de CÃ³digo

### TypeScript
```typescript
// âœ… BOM
interface Participant {
  nome: string;
  email: string;
}

function addParticipant(participant: Participant): void {
  // ...
}

// âŒ RUIM
function addParticipant(participant: any) {
  // ...
}
```

### React Components
```typescript
// âœ… BOM
interface ParticipantListProps {
  participants: Participant[];
  onRemove: (id: string) => void;
}

export default function ParticipantList({ 
  participants, 
  onRemove 
}: ParticipantListProps) {
  return (
    // JSX
  );
}

// âŒ RUIM
export default function ParticipantList(props: any) {
  // ...
}
```

### Hooks
```typescript
// âœ… BOM
/**
 * Hook para gerenciar lista de participantes
 * @param initialParticipants - Lista inicial de participantes
 * @returns Objeto com participantes e funÃ§Ãµes de manipulaÃ§Ã£o
 */
export function useParticipants(initialParticipants: Participant[] = []) {
  const [participants, setParticipants] = useState<Participant[]>(initialParticipants);
  
  const addParticipant = useCallback((participant: Participant) => {
    setParticipants(prev => [...prev, participant]);
  }, []);
  
  return { participants, addParticipant };
}
```

## Naming Conventions

- **VariÃ¡veis/FunÃ§Ãµes**: camelCase (`getMeetingMinutes`)
- **Constantes**: UPPER_SNAKE_CASE (`MAX_ITEMS_PER_PAGE`)
- **Componentes**: PascalCase (`MeetingMinutesList`)
- **Types/Interfaces**: PascalCase (`MeetingMinutes`)
- **Arquivos de componente**: PascalCase (`MeetingMinutesList.tsx`)
- **Arquivos de utilitÃ¡rios**: kebab-case (`format-date.ts`)

## Estrutura de Pastas

```
src/
â”œâ”€â”€ components/          # Componentes reutilizÃ¡veis
â”‚   â”œâ”€â”€ ui/             # Componentes bÃ¡sicos
â”‚   â””â”€â”€ layout/          # Layout components
â”œâ”€â”€ features/           # Features organizadas
â”‚   â”œâ”€â”€ atas/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ participantes/
â”‚   â””â”€â”€ itens/
â”œâ”€â”€ services/           # ServiÃ§os compartilhados
â”œâ”€â”€ hooks/              # Custom hooks compartilhados
â”œâ”€â”€ utils/              # FunÃ§Ãµes utilitÃ¡rias
â”œâ”€â”€ types/              # Types globais
â””â”€â”€ styles/             # Estilos globais
```

## Regras EspecÃ­ficas do Projeto

### Armazenamento Local
- Use o serviÃ§o `storageService` para todas as operaÃ§Ãµes de localStorage
- Sempre trate erros de localStorage (quota excedida, etc)
- Valide dados ao recuperar do localStorage

### GeraÃ§Ã£o de HTML
- Separe a lÃ³gica de geraÃ§Ã£o de HTML em serviÃ§o dedicado
- Use templates/strings para construÃ§Ã£o de HTML
- Mantenha estilos inline ou em seÃ§Ã£o `<style>` no HTML gerado
- Implemente paginaÃ§Ã£o automÃ¡tica baseada em altura estimada

### Hierarquia de Itens
- NumeraÃ§Ã£o automÃ¡tica: "1", "1.1", "1.1.1"
- Valide hierarquia ao criar/editar itens
- Mantenha referÃªncias pai/filho consistentes

### Rastreabilidade
- Todas as aÃ§Ãµes devem gerar entrada no histÃ³rico
- Inclua timestamp, responsÃ¡vel e descriÃ§Ã£o
- Mantenha histÃ³rico imutÃ¡vel (nÃ£o edite, apenas adicione)

### ExportaÃ§Ã£o
- HTML deve ser auto-contido (sem dependÃªncias externas)
- Inclua filtros interativos no HTML gerado
- Suporte a impressÃ£o (CSS @media print)

## Testes (quando implementados)

- Teste funÃ§Ãµes utilitÃ¡rias
- Teste hooks com `@testing-library/react-hooks`
- Teste componentes com `@testing-library/react`
- Cobertura mÃ­nima: 70% para serviÃ§os crÃ­ticos

## Performance

- Use `React.memo` para componentes pesados
- Use `useMemo` e `useCallback` quando apropriado
- Lazy load de componentes grandes
- Debounce em inputs de busca/filtro

## Acessibilidade

- Use elementos semÃ¢nticos HTML
- Adicione `aria-label` em botÃµes sem texto
- Suporte navegaÃ§Ã£o por teclado
- Contraste adequado de cores

## Tratamento de Erros

- Sempre trate erros de forma explÃ­cita
- Use try/catch em operaÃ§Ãµes assÃ­ncronas
- ForneÃ§a feedback ao usuÃ¡rio em caso de erro
- Log erros para debug (console.error em dev)

## ComentÃ¡rios e DocumentaÃ§Ã£o

- JSDoc para funÃ§Ãµes pÃºblicas
- ComentÃ¡rios explicativos para lÃ³gica complexa
- README.md em cada feature principal
- Documente decisÃµes arquiteturais importantes

## Git

- Commits descritivos e atÃ´micos
- Branch por feature (`feature/nome-da-feature`)
- PRs com descriÃ§Ã£o clara das mudanÃ§as
- NÃ£o commite arquivos gerados ou dependÃªncias

## DependÃªncias

- Prefira bibliotecas leves e bem mantidas
- Evite dependÃªncias desnecessÃ¡rias
- Mantenha dependÃªncias atualizadas (security patches)
- Documente dependÃªncias crÃ­ticas no README

## Estilos

- Use CSS Modules para estilos scoped
- CSS Variables para temas
- Mobile-first quando aplicÃ¡vel
- ConsistÃªncia visual com design system bÃ¡sico

## ValidaÃ§Ã£o

- Valide inputs do usuÃ¡rio
- Valide dados ao recuperar do storage
- Mensagens de erro claras e Ãºteis
- ValidaÃ§Ã£o tanto no cliente quanto na lÃ³gica de negÃ³cio

---

## LiÃ§Ãµes aprendidas â€“ UX e operaÃ§Ã£o fluida

Use estas diretrizes para manter a ferramenta fÃ¡cil de operar e consistente com as decisÃµes jÃ¡ tomadas.

### FormulÃ¡rio e ediÃ§Ã£o

- **FormulÃ¡rio de ata em pÃ¡gina cheia** (nÃ£o modal): ocupa toda a tela para melhor uso do espaÃ§o; header com "Voltar", etapas e aÃ§Ãµes (Cancelar / AvanÃ§ar / Salvar).
- **EdiÃ§Ã£o de item inline**: formulÃ¡rio de ediÃ§Ã£o do item aparece **logo abaixo** do item, em layout **horizontal** (descriÃ§Ã£o, responsÃ¡vel, data, status, aÃ§Ãµes), para que outros itens continuem visÃ­veis enquanto um Ã© editado.
- **DescriÃ§Ã£o**: campo maior, multi-linha, com **rich text** (negrito, itÃ¡lico, sublinhado e cores da paleta Vale); exibir conteÃºdo com HTML **sanitizado** (`sanitizeHtml`); armazenar HTML no histÃ³rico.

### HistÃ³rico de itens

- **CriaÃ§Ã£o**: novo item tem **um Ãºnico** registro de histÃ³rico (vazio); a primeira ediÃ§Ã£o **substitui** esse registro em vez de acrescentar outro.
- **Por linha de histÃ³rico**: botÃ£o para **editar data de criaÃ§Ã£o** (ğŸ“…) e botÃ£o **excluir** (âœ•) ao lado do texto; **sempre** usar confirmaÃ§Ã£o (`window.confirm`) antes de excluir histÃ³rico.
- **ExclusÃ£o de histÃ³rico**: permitida apenas no **mesmo dia** ou **dia seguinte** Ã  data de criaÃ§Ã£o (`criadoEm`) do registro; e apenas se o item tiver **mais de um** histÃ³rico.

### Arquivamento

- Ao **copiar** uma ata, a ata **original** Ã© marcada como **arquivada** (`setAtaArquivada`); a nova ata Ã© criada normalmente.
- Na lista: atas arquivadas exibem badge **"Arquivada"** e **nÃ£o** mostram botÃ£o Editar (somente Copiar/Excluir conforme regras gerais).

### BotÃµes e aÃ§Ãµes (economia de espaÃ§o e clareza)

- **AÃ§Ãµes de item**: preferir **Ã­cones com tooltip** (Editar âœï¸, Adicionar subitem â•, Excluir ğŸ—‘ï¸) em vez de texto longo.
- **Expandir/recolher subitens**: botÃ£o **Ã  esquerda** do item (estilo Excel), **apenas Ã­cone** (â–¶/â–¼), sem texto; cÃ©lula fixa para alinhamento (vazio quando item nÃ£o tem filhos).
- **Recuo por nÃ­vel**: usar **~10px por nÃ­vel** de hierarquia para nÃ£o consumir espaÃ§o em itens profundos (ex.: 1.1.1.1.1.1).

### ResponsÃ¡vel do item

- **Seletor Ãºnico**: dropdown **pesquisÃ¡vel** com os **integrantes da ata** (participantes da etapa 1); opÃ§Ã£o **"Adicionar novo integrante Ã  ata"** que adiciona o participante e jÃ¡ o seleciona como responsÃ¡vel. Componente dedicado (`ResponsavelSelect`).

### Status

- **SeleÃ§Ã£o**: **chips coloridos** (um por status) em vez de `<select>`, usando **paleta Vale**; chip selecionado = fundo preenchido, nÃ£o selecionado = borda + texto na cor.
- **Badges na lista**: mesma paleta Vale por status (Pendente, Em Andamento, ConcluÃ­do, Cancelado, Info), com fundo claro e borda.

### Hierarquia visual (estilo Primavera P6 / Vale)

- **Item sem filhos**: sempre **fundo branco** (em qualquer nÃ­vel).
- **Item com filhos**: fundo por **nÃ­vel** â€“ raiz (nÃ­vel 1) mais marcado, nÃ­veis mais profundos mais claros; tons **claros da paleta Vale** (teal/aqua), alternados; borda esquerda na cor primÃ¡ria.
- **Bordas**: preferir **pouco arredondamento** (ex.: 2px) para aspecto mais â€œsÃ©rioâ€.

### Pesquisa e filtros (etapa de itens)

- **Pesquisa no topo**: campo de busca por **nÃºmero do item** ou **texto da descriÃ§Ã£o** (remover HTML para busca com `stripHtml`).
- **Filtro opcional**: checkbox para **ocultar** itens ConcluÃ­dos, Cancelados e Info **que nÃ£o foram editados no dia da reuniÃ£o** (comparar `UltimoHistorico.criadoEm` com `cabecalho.data`).

### ExpansÃ£o de subitens

- **PadrÃ£o**: subitens **expandidos por padrÃ£o** ao carregar (incluir todos os pais em `expandedIds` na primeira carga).
- **Ao adicionar subitem**: **expandir automaticamente** o item-pai para o novo subitem aparecer de imediato (ex.: `handleAddSubItem` que chama `onAddSubItem` e adiciona o pai a `expandedIds`).

### ExclusÃ£o de item

- **Visibilidade**: botÃ£o Excluir **nÃ£o aparece** se o item **tiver filhos** (subitens).
- **Habilitado**: apenas se o item tiver **no mÃ¡ximo um** registro de histÃ³rico; caso contrÃ¡rio, orientar a excluir histÃ³ricos antes (tooltip quando desabilitado).
- **ConfirmaÃ§Ã£o**: **sempre** exibir mensagem clara e sÃ©ria (ex.: "Tem certeza que deseja EXCLUIR este item? Esta aÃ§Ã£o nÃ£o pode ser desfeita e excluirÃ¡ tambÃ©m todos os subitens, se houver.") antes de executar a exclusÃ£o.

### Paleta Vale (referÃªncia)

- Usar para status, rich text e consistÃªncia visual: Verde-Vale `#007E7A`, Aqua-Vale `#0ABB98`, Azul-Vale `#3CB5E5`, Cinza-Escuro `#555555`, Amarelo-Vale `#ECB11F`, Laranja-Vale `#EE6F16`, Cereja-Vale `#C0305E`, Preto `#000000`, Branco `#FFFFFF`.

### ReferÃªncia de comportamento

- Quando houver dÃºvida sobre fluxo ou regra de negÃ³cio, consultar **SistemaReferencia.pa.yaml** (PowerApps) para alinhar ao comportamento do app antigo, adaptando para a paleta e padrÃµes acima.
